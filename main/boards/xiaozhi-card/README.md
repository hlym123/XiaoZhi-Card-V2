# XiaoZhi Card

* [产品文档](https://docs.m5stack.com/zh_CN/core/Xiaozhi_Card_Kit)

-----------------------------------
## 获取源码

```shell
git clone https://github.com/m5stack/XiaoZhi-Card.git 

cd XiaoZhi-Card

git submodule update --init --recursive 
```

-----------------------------------
## 编译、烧录

* esp-idf veriosn: ESP-IDF v6.0-dev-1489-g4e036983a7
 
1. 配置编译目标  

```shell
idf.py set-target esp32s3
```

2. 修改配置

```shell
cp ./main/boards/xiaozhi-card/sdkconfig sdkconfig 
```
 
3. 编译，烧录固件 

> [!NOTE]
> 长按底座按键到灯亮绿色，进入 USB 烧录固件模式。

```shell
idf.py build flash monitor
```


------------------------------------
## 功能说明 v1.8.5 


* 启动
    * 电量检查 
    * 引导页面 
        * 进入引导页面
        * 不再提示 (版本变更后才会重新提示)
    * 开机 --> 播放开机声音 
    * 入网 --> 播放欢迎语
    * OTA 检查
        * 确认升级
        * 跳过升级 
* 主页面
    * 状态栏
        * 信号
        * 时间
        * 电量
    * 表情
    * 信息
    * 对话按钮  
        * 对话
        * 退出
        * 暂停：静音 停止语音输出
        * 继续：取消静音 继续语音输出
    * 新对话按钮
    * 下拉进入设置页面 
    * 左滑、右滑触发全刷（无提示音） 
* 设置页面
    * 网络切换 WiFi/4G
    * 重新配置 Wi-Fi  
    * 音量设置 (音量掉电保存)
    * 开启/关闭 自动休眠
    * 休眠
    * 关机
    * 电量显示 
    * 返回
* 休眠，唤醒
    * 自动休眠，3 分钟无对话进入休眠模式 
        * 上电开机默认开启自动休眠模式
        * 充电状态下默认关闭自动休眠 (在引导页面时无效)
    * 手动 开启/关闭 休眠模式后，自动休眠失效  
* 用户按键 
    * 单击切换对话状态 
    * 双击关机 
    * 关机状态下，单击开机 
* 低电量自动关机 
    * 电池电压低于 3.4V 关机 
* 全刷策略
    * 自动触发
        * 开机
        * 对话时长超 30 秒，退出对话时 -- 触发 AFE is full !!!
        * 设置页面返回主页面时 
        * 引导页进入主页面 
    * 手动触发
        * 主界面左滑、右滑
 
TODO:

1. 对话时长超 30 秒，退出对话时 -- 全刷 触发 AFE is full !!!
2. 引导页面不会根据充电状态设置改变休眠模式 
3. 低电量 4G 模组可能启动失败

-----------------------------------
## MCP 

